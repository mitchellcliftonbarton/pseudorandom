var express=require("express"),app=express(),path=require("path"),fs=require("fs"),winston=require("winston"),parser=require("body-parser");winston.add(winston.transports.File,{filename:"winston.log"}),winston.info("Hello again distributed logs"),app.use(express["static"]("public")),app.use(express.json({limit:"50mb"})),app.use(express.urlencoded({limit:"50mb",extended:!0})),app.get("/",function(e,n){n.sendFile("index.html"),winston.info("GET - /")}),app.get("/grid",function(e,n,i){n.sendFile("grid.html",{root:path.join(__dirname,"public")}),winston.info("GET - /grid")}),app.get("/loop",function(e,n,i){n.sendFile("lg-view.html",{root:path.join(__dirname,"public")}),winston.info("GET - /loop")}),app.get("/images",function(e,n,i){winston.info("GET - /images"),fs.readdir("public/new-images",function(e,i){e&&console.log(e),console.log(i),n.send(i)})}),app.post("/save",function(e,n,i){function s(e){e?console.log("broken"):console.log("yay")}winston.info("POST - /save");var o="";e.on("data",function(e){o+=e}),e.on("end",function(){var e=o.indexOf("data"),n=o.slice(0,e),i=o.toString().indexOf(",")+1,s=new Buffer(o.substring(i),"base64");winston.info("Attempting to write: "+n),fs.writeFile("public/new-images/"+n+".jpg",s,function(e){e&&winston.info("Error: "+e)})}),n.send("Done")});var server=app.listen(3e3,function(){var e=server.address().address,n=server.address().port;console.log("Example app listening at http://%s:%s",e,n)});