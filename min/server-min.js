var express=require("express"),bodyParser=require("body-parser"),app=express(),path=require("path"),fs=require("fs"),http=require("http"),winston=require("winston");winston.add(winston.transports.File,{filename:"winston.log"}),winston.info("Logging"),app.use(express["static"]("public")),app.use(bodyParser.urlencoded({limit:"10mb",extended:!0})),app.get("/",function(n,e){e.sendFile("index.html"),winston.info("GET - /")}),app.get("/grid",function(n,e,o){e.sendFile("grid.html",{root:path.join(__dirname,"public")}),winston.info("GET - /grid")}),app.get("/loop",function(n,e,o){e.sendFile("lg-view.html",{root:path.join(__dirname,"public")}),winston.info("GET - /loop")}),app.get("/show",function(n,e,o){e.sendFile("new-show.html",{root:path.join(__dirname,"public")}),winston.info("GET - /show-2")}),app.get("/group",function(n,e,o){e.sendFile("group.html",{root:path.join(__dirname,"public")}),winston.info("GET - /group")}),app.get("/info",function(n,e,o){e.sendFile("info.html",{root:path.join(__dirname,"public")}),winston.info("GET - /info")}),app.get("/images",function(n,e,o){winston.info("GET - /images"),fs.readdir("public/new-images",function(n,o){n&&console.log(n),console.log(o),e.send(o)})}),app.post("/save",function(n,e,o){function i(n){n?console.log("broken"):console.log("yay")}winston.info("POST - /save"),winston.info("starting save");var t="";n.on("data",function(n){t+=n}),n.on("end",function(){var n=t.indexOf("data"),e=t.slice(0,n),o=t.toString().indexOf(",")+1,i=new Buffer(t.substring(o),"base64");winston.info("Writing: "+e),fs.writeFile("public/new-images/"+e+".jpg",i,function(n){n?winston.info("Error: "+n):winston.info("Success: Saved "+e)})}),e.send("Done")}),app.post("/sand",function(n,e,o){function i(n){n?console.log("broken"):console.log("yay")}var t="";n.on("data",function(n){t+=n}),n.on("end",function(){var n=t.indexOf("-"),e=t.slice(0,n),o=new Date,i=o.toUTCString();i=i.replace(/\s+/g,"-"),e=i+"-"+e,e=e.replace(",","");var s=t.toString().indexOf(",")+1,r=new Buffer(t.substring(s),"base64");fs.writeFile("public/gray-sand/"+e+".jpg",r,function(n){n?winston.info("Error: "+n):winston.info("Success: Saved "+e)})}),e.send("Done")}),app.post("/shapes",function(n,e,o){var i=Math.floor(50*Math.random()+1);fs.readdir("public/shapes",function(n,o){n&&console.log(n),fs.readFile(path.join(__dirname,"public")+"/shapes/"+o[i%o.length],"base64",function(n,o){e.send("data:image/png;base64,"+o)})})}),app.post("/web-performance",function(n,e,o){var i=querystring.stringify({msg:"performanced"}),t={hostname:"chrome-extension://jmnlphecjmkmdnilaijdlekceifniclb",port:80,path:"/background.js",method:"POST",headers:{"Content-Type":"application/json","Content-Length":i.length}};poster.write(i),poster.end()});var server=app.listen(3e3,function(){var n=server.address().address,e=server.address().port;console.log("Example app listening at http://%s:%s",n,e)});